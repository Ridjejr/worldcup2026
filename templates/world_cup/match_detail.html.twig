{% extends 'base.html.twig' %}

{% block title %}D√©tail du match{% endblock %}

{% block stylesheets %}
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Bebas+Neue&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #0f1419; color: #ffffff; }

        .header { background: linear-gradient(180deg, #1a1f2e 0%, #141923 100%); border-bottom: 1px solid #2a3441; position: sticky; top: 0; z-index: 100; }
        .header-container { max-width: 1440px; margin: 0 auto; padding: 0 48px; display: flex; justify-content: space-between; align-items: center; height: 80px; }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-text { font-family: 'Bebas Neue', cursive; font-size: 28px; letter-spacing: 1.5px; background: linear-gradient(135deg, #00ff87 0%, #60efff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav { display: flex; gap: 40px; }
        .nav-item { color: #8899a6; text-decoration: none; font-weight: 600; font-size: 15px; transition: color 0.3s; position: relative; }
        .nav-item:hover { color: #ffffff; }

        .container { max-width: 900px; margin: 0 auto; padding: 32px 48px; }

        .back { color:#8899a6; text-decoration:none; font-weight:600; display:inline-block; margin-bottom: 18px; }
        .back:hover { color:#fff; }

        .card {
            background: linear-gradient(135deg, #1a1f2e 0%, #141923 100%);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid #2a3441;
        }

        .match-header { display:flex; justify-content:space-between; align-items:center; margin-bottom: 18px; }
        .pill { padding: 6px 16px; border-radius: 20px; font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; background:#2a3441; color:#8899a6; }
        .pill.live { background: linear-gradient(135deg, #00ff87 0%, #00d980 100%); color:#0f1419; }

        .teams { display:grid; grid-template-columns: 1fr auto 1fr; align-items:center; gap: 20px; }
        .team { display:flex; align-items:center; gap: 14px; }
        .team.away { flex-direction: row-reverse; text-align:right; }
        .flag { font-size: 48px; }
        .name { font-weight: 800; font-size: 22px; }
        .code { color:#8899a6; font-size: 13px; font-weight: 600; }

        .scorebox { text-align:center; min-width: 140px; }
        .score { font-family: 'Bebas Neue', cursive; font-size: 60px; color:#00ff87; line-height:1; }
        .meta { margin-top: 6px; color:#8899a6; font-weight:600; font-size: 13px; }

        .info { display:flex; gap: 16px; flex-wrap: wrap; margin-top: 18px; padding-top: 18px; border-top: 1px solid #2a3441; color:#8899a6; font-weight:600; }
    </style>
{% endblock %}

{% block body %}
<div class="header">
    <div class="header-container">
        <div class="logo">
            <span style="font-size: 32px;">‚öΩ</span>
            <span class="logo-text">WORLD CUP 2026</span>
        </div>
        <nav class="nav">
            <a href="{{ path('app_home') }}" class="nav-item">Accueil</a>
            <a href="{{ path('app_groupes') }}" class="nav-item">Groupes</a>
        </nav>
    </div>
</div>

<div class="container">
    <a class="back" href="{{ path('app_home') }}">‚Üê Retour</a>

    <div class="card">
        <div class="match-header">
            <div style="font-weight:800;">{{ match.phase.libelle }}</div>
            <div id="statusPill" class="pill {{ match.statut == 'EN_COURS' ? 'live' : '' }}">
                {{ match.statut }}
            </div>
        </div>

        <div class="teams">
            <div class="team">
                <div class="flag">{{ domicile and domicile.equipe.drapeau ? domicile.equipe.drapeau : 'üè¥' }}</div>
                <div>
                    <div class="name">{{ domicile ? domicile.equipe.nomEquipe : '---' }}</div>
                    <div class="code">{{ domicile ? domicile.equipe.codePays : '' }}</div>
                </div>
            </div>

            <div class="scorebox">
                <div class="score">
                    <span id="scoreDom">{{ domicile and domicile.buts is not null ? domicile.buts : 0 }}</span>
                    -
                    <span id="scoreExt">{{ exterieur and exterieur.buts is not null ? exterieur.buts : 0 }}</span>
                </div>
                <div class="meta">
                    {{ match.dateHeure|date('d/m/Y H:i') }}
                </div>
            </div>

            <div class="team away">
                <div class="flag">{{ exterieur and exterieur.equipe.drapeau ? exterieur.equipe.drapeau : 'üè¥' }}</div>
                <div>
                    <div class="name">{{ exterieur ? exterieur.equipe.nomEquipe : '---' }}</div>
                    <div class="code">{{ exterieur ? exterieur.equipe.codePays : '' }}</div>
                </div>
            </div>
        </div>

        <div class="info">
            <div>üèüÔ∏è {{ match.stade.nom }}, {{ match.stade.ville }}</div>
            <div>üìå Statut : <span id="statusText">{{ match.statut }}</span></div>
        </div>
    </div>
</div>

<script>
(async function () {
    const matchId = {{ match.id }};
    const url = "{{ path('api_match_live', { id: match.id }) }}";

    async function refresh() {
        try {
            const res = await fetch(url, { headers: { 'Accept': 'application/json' }});
            if (!res.ok) return;

            const data = await res.json();

            // score
            if (data.domicile && typeof data.domicile.buts !== 'undefined') {
                document.getElementById('scoreDom').textContent = data.domicile.buts ?? 0;
            }
            if (data.exterieur && typeof data.exterieur.buts !== 'undefined') {
                document.getElementById('scoreExt').textContent = data.exterieur.buts ?? 0;
            }

            // statut
            document.getElementById('statusText').textContent = data.statut;
            const pill = document.getElementById('statusPill');
            pill.textContent = data.statut;
            pill.classList.toggle('live', data.statut === 'EN_COURS');

        } catch (e) {
            // silencieux (bonne pratique : pas divulguer d‚Äôinfos)
        }
    }

    // Si match en cours : polling toutes les 15s
    {% if match.statut == 'EN_COURS' %}
        setInterval(refresh, 15000);
    {% endif %}
})();
</script>
{% endblock %}
